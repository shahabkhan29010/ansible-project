---
- name: Configuring Layer-3 interfaces
  hosts: 
    - spine
    - router
  gather_facts: no
  connection: network_cli

  tasks:
  - name: Configuring Layer-3 interfaces on spines
    when: inventory_hostname == 'lab-sw01'
    cisco.nxos.nxos_interfaces:
      config:
        - name: Ethernet1/6
          mode: layer3
          enabled: true
      state: merged
  - name: Configuring Layer-3 interfaces on spines
    when: inventory_hostname == 'lab-sw02'
    cisco.nxos.nxos_interfaces:
      config:
        - name: Ethernet1/6
          mode: layer3
          enabled: true
      state: merged

  - name: Assigning IP address
    when: inventory_hostname == 'lab-sw01'
    cisco.nxos.nxos_l3_interfaces:
      config:
        - name: Ethernet1/6
          ipv4:
            - address: 11.11.11.2/30
      state: merged

  - name: Assigning IP address
    when: inventory_hostname == 'lab-sw02'
    cisco.nxos.nxos_l3_interfaces:
      config:
        - name: Ethernet1/6
          ipv4:
            - address: 12.12.12.2/30
      state: merged

  - name: Enable interface on the router
    when: inventory_hostname == 'lab-r01'
    cisco.ios.ios_interfaces:
      config:
        - name: GigabitEthernet1
          description: Connected to OOB Management

        - name: GigabitEthernet2
          description: Connected to Spine 01
          enabled: true

        - name: GigabitEthernet3
          description: Connected to Spine 02
          enabled: true
      state: merged

  - name: Configure IP address
    when: inventory_hostname == 'lab-r01'
    cisco.ios.ios_l3_interfaces:
      config:
        - name: GigabitEthernet2
          ipv4:
            - address: 11.11.11.1/30
        - name: GigabitEthernet3
          ipv4:
            - address: 12.12.12.1/30
      state: merged
      