---
- name: Configure BGP in IOS Router
  cisco.ios.ios_bgp_global:
    config:
      as_number: "{{ asn }}"
      neighbor:
        - neighbor_address: "{{ item.address }}"
          remote_as: "{{ item.remote_asn }}"
          activate: true
    state: merged
  loop: "{{ neighbors }}"

- name: Activate BGP neighbor in address family
  cisco.ios.ios_bgp_address_family:
    config:
      as_number: "{{ asn }}"
      address_family:
        - afi: ipv4
          safi: unicast
          neighbors:
            - activate: true
              neighbor_address: "{{ item.address }}"
    state: merged
  loop: "{{ neighbors }}"
