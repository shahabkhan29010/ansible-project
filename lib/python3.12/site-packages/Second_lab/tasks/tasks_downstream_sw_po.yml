---
- name: Assign VLANs to the port-channel
  cisco.nxos.nxos_l2_interfaces:
    config:
      - name: port-channel101
        mode: trunk
        trunk:
          allowed_vlans: "{{ l2_vlans.vlan_id | join(',') }}"
    state: merged

- name: Configure port-channel as peer-link
  cisco.nxos.nxos_vpc_interface:
    portchannel: 101
    peer_link: true
    state: present

- name: Configure interface as L2
  cisco.nxos.nxos_interfaces:
    config:
      - name: Ethernet1/6
        enabled: true
        mode: layer2
    state: merged

- name: Configure interface as trunk port
  cisco.nxos.nxos_l2_interfaces:
    config:
      - name: Ethernet1/6
        mode: trunk
    state: merged

- name: Configure port-channel for access switches
  cisco.nxos.nxos_lag_interfaces:
    config:
      - name: port-channel10
        members:
          - member: Ethernet1/6
            mode: active
            force: true
    state: merged

- name: Assign VLANs to the port-channel towards access switches
  cisco.nxos.nxos_l2_interfaces:
    config:
      - name: port-channel10
        mode: trunk
        trunk:
          allowed_vlans: "{{ l2_vlans.vlan_id | join(',') }}"
    state: merged

- name: Assign port-channel towards access switches
  cisco.nxos.nxos_vpc_interface:
    portchannel: 10
    vpc: 10