---
- name: Configuring SVIs on leaf01
  when: inventory_hostname == 'leaf01'
  cisco.nxos.nxos_l3_interfaces:
    config:
      - name: "{{ item.vlan_id }}"
        ipv4:
          - address: "{{ item.ip_address }}"
    state: merged
  loop: "{{ leaf01_svi }}"

- name: Enable the SVI on leaf01
  when: inventory_hostname == 'leaf01'
  cisco.nxos.nxos_interfaces:
    config:
      - name: "{{ item.vlan_id }}"
        enabled: true
    state: merged
  loop: "{{ leaf01_svi }}"

- name: Configuring HSRP on leaf01
  when: inventory_hostname == 'leaf01'
  cisco.nxos.nxos_hsrp:
        interface: "{{ item.vlan_id }}"
        group: "{{ item.group_id }}"
        preempt: enabled
        priority: 250
        version: 2
        vip: "{{ item.vip }}"
        state: present
  loop: "{{ leaf01_svi }}"

- name: Configuring SVIs on leaf02
  when: inventory_hostname == 'leaf02'
  cisco.nxos.nxos_l3_interfaces:
    config:
      - name: "{{ item.vlan_id }}"
        ipv4:
          - address: "{{ item.ip_address }}"
    state: merged
  loop: "{{ leaf02_svi }}"

- name: Enable the SVI on leaf02
  when: inventory_hostname == 'leaf02'
  cisco.nxos.nxos_interfaces:
    config:
      - name: "{{ item.vlan_id }}"
        enabled: true
    state: merged
  loop: "{{ leaf02_svi }}"

- name: Configuring HSRP on leaf02
  when: inventory_hostname == 'leaf02'
  cisco.nxos.nxos_hsrp:
        interface: "{{ item.vlan_id }}"
        group: "{{ item.group_id }}"
        priority: default
        version: 2
        vip: "{{ item.vip }}"
        state: present
  loop: "{{ leaf02_svi }}"
